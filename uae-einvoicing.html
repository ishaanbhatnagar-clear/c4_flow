<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAE E-Invoicing - Complete Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #ffffff;
            --bg-secondary: #f7f7f8;
            --bg-tertiary: #ececf1;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-muted: #999999;
            --border-color: #e5e5e5;
            --border-dark: #d0d0d0;
            --accent: #1a1a1a;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --info: #2563eb;
            --purple: #7c3aed;
            --uae-green: #00732f;
            --uae-red: #ce1126;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 32px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .header .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Nav Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 24px;
            padding: 6px;
            background: var(--bg-secondary);
            border-radius: 10px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--text-secondary);
        }

        .nav-tab:hover {
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: white;
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Step Controls */
        .step-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding: 14px 24px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .step-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .step-btn.primary {
            background: var(--uae-green);
            color: white;
        }

        .step-btn.primary:hover:not(:disabled) {
            background: #005a25;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 115, 47, 0.3);
        }

        .step-btn.secondary {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border-dark);
        }

        .step-btn.secondary:hover:not(:disabled) {
            background: var(--bg-tertiary);
        }

        .step-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .step-indicator strong {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 14px;
        }

        .step-progress {
            display: flex;
            gap: 6px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .step-dot:hover {
            border-color: var(--text-secondary);
        }

        .step-dot.active {
            background: var(--uae-green);
            transform: scale(1.2);
        }

        .step-dot.completed {
            background: var(--success);
        }

        .step-title {
            min-width: 280px;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
            text-align: center;
        }

        /* Diagram Container */
        .diagram-container {
            background: var(--bg-main);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 20px;
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .diagram-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .svg-container {
            display: flex;
            justify-content: center;
        }

        /* Animated elements */
        .step-element {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .step-element.visible {
            opacity: 1;
        }

        .step-element.animate-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Legend */
        .legend-bar {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .legend-line {
            width: 24px;
            height: 2px;
        }

        .legend-line.solid { background: var(--uae-green); }
        .legend-line.dashed {
            background: repeating-linear-gradient(
                90deg,
                var(--info) 0px,
                var(--info) 4px,
                transparent 4px,
                transparent 8px
            );
        }
        .legend-line.tax {
            background: repeating-linear-gradient(
                90deg,
                var(--uae-red) 0px,
                var(--uae-red) 4px,
                transparent 4px,
                transparent 8px
            );
        }

        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 24px;
        }

        @media (max-width: 900px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: var(--bg-main);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .info-card-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            background: var(--bg-secondary);
        }

        .info-card-header h3 {
            font-size: 14px;
            font-weight: 700;
            flex: 1;
        }

        .info-card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: var(--bg-tertiary);
        }

        .expand-icon {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .info-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .info-card-body {
            padding: 0 18px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .info-card.expanded .info-card-body {
            padding: 18px;
            max-height: 2000px;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-table th,
        .data-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--bg-tertiary);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .status-dot.green { background: var(--success); }
        .status-dot.orange { background: var(--warning); }
        .status-dot.red { background: var(--error); }
        .status-dot.blue { background: var(--info); }

        /* Timeline */
        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            width: 45%;
        }

        .timeline-item:nth-child(odd) {
            margin-left: 5%;
            text-align: right;
            padding-right: 40px;
        }

        .timeline-item:nth-child(even) {
            margin-left: 50%;
            padding-left: 40px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--uae-green);
            border-radius: 50%;
            top: 5px;
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--uae-green);
        }

        .timeline-item:nth-child(odd)::before {
            right: -8px;
        }

        .timeline-item:nth-child(even)::before {
            left: -8px;
        }

        .timeline-date {
            font-size: 12px;
            font-weight: 700;
            color: var(--uae-green);
            margin-bottom: 4px;
        }

        .timeline-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .timeline-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Accreditation Steps */
        .accred-flow {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin: 20px 0;
        }

        .accred-step {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            text-align: center;
            min-width: 140px;
            transition: all 0.3s ease;
            opacity: 0.5;
        }

        .accred-step.active {
            opacity: 1;
            border-color: var(--uae-green);
            background: white;
            box-shadow: 0 4px 12px rgba(0, 115, 47, 0.15);
        }

        .accred-step.completed {
            opacity: 1;
            border-color: var(--success);
            background: #ecfdf5;
        }

        .accred-step-num {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--border-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            margin: 0 auto 8px;
        }

        .accred-step.active .accred-step-num {
            background: var(--uae-green);
        }

        .accred-step.completed .accred-step-num {
            background: var(--success);
        }

        .accred-step-title {
            font-size: 11px;
            font-weight: 600;
        }

        .accred-arrow {
            display: flex;
            align-items: center;
            color: var(--border-dark);
            font-size: 20px;
        }

        /* PKI Diagram */
        .pki-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }

        .pki-node {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 12px 20px;
            text-align: center;
            position: relative;
        }

        .pki-node.root {
            border-color: var(--uae-red);
            background: #fef2f2;
        }

        .pki-node.intermediate {
            border-color: var(--warning);
            background: #fffbeb;
        }

        .pki-node.leaf {
            border-color: var(--uae-green);
            background: #ecfdf5;
        }

        .pki-node-title {
            font-size: 12px;
            font-weight: 700;
        }

        .pki-node-desc {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .pki-children {
            display: flex;
            gap: 40px;
            position: relative;
        }

        .pki-children::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-color);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--uae-green);
        }

        .section-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            background: var(--uae-green);
        }

        .section-header h2 {
            font-size: 18px;
            font-weight: 700;
        }

        /* Requirement List */
        .req-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }

        .req-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 13px;
        }

        .req-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--uae-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        /* Footer */
        .footer {
            margin-top: 32px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 11px;
            color: var(--text-muted);
        }

        .footer a {
            color: var(--uae-green);
            text-decoration: none;
            font-weight: 600;
        }

        /* Penalty Table */
        .penalty-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }

        .penalty-table th,
        .penalty-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        .penalty-table th {
            background: var(--uae-red);
            color: white;
            font-size: 11px;
            text-transform: uppercase;
        }

        .penalty-table td {
            font-size: 13px;
        }

        .penalty-amount {
            font-weight: 700;
            color: var(--error);
        }

        /* Code Block */
        .code-block {
            background: #1a1a1a;
            color: #e5e5e5;
            padding: 16px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .code-block .tag { color: #7dd3fc; }
        .code-block .attr { color: #fda4af; }
        .code-block .value { color: #86efac; }

        @media (max-width: 768px) {
            .container { padding: 16px 12px; }
            .header h1 { font-size: 22px; }
            .step-controls { flex-direction: column; gap: 10px; }
            .step-title { min-width: auto; }
            .timeline-item { width: 100% !important; margin-left: 30px !important; text-align: left !important; padding-left: 30px !important; padding-right: 0 !important; }
            .timeline-item::before { left: -8px !important; right: auto !important; }
            .timeline-line { left: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>UAE E-Invoicing System</h1>
            <p class="subtitle">Complete Guide to DCTCE Model, Accreditation & Compliance</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('flow')">5-Corner Flow</button>
            <button class="nav-tab" onclick="showTab('accreditation')">ASP Accreditation</button>
            <button class="nav-tab" onclick="showTab('timeline')">Timeline</button>
            <button class="nav-tab" onclick="showTab('technical')">Technical Specs</button>
            <button class="nav-tab" onclick="showTab('pki')">PKI & Certificates</button>
        </div>

        <!-- ==================== 5-CORNER FLOW TAB ==================== -->
        <div id="flow-tab" class="tab-content active">
            <div class="step-controls">
                <button class="step-btn secondary" id="prevBtn" onclick="prevStep()" disabled>
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                    </svg>
                    Previous
                </button>

                <div class="step-indicator">
                    <span>Step</span>
                    <strong id="currentStep">1</strong>
                    <span>of</span>
                    <strong id="totalSteps">8</strong>
                </div>

                <div class="step-progress" id="stepProgress"></div>

                <div class="step-title" id="stepTitle">Seller creates invoice in ERP</div>

                <button class="step-btn primary" id="nextBtn" onclick="nextStep()">
                    Next Step
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                    </svg>
                </button>

                <button class="step-btn secondary" id="resetBtn" onclick="resetSteps()">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                    </svg>
                    Reset
                </button>
            </div>

            <div class="diagram-container">
                <div class="diagram-title">UAE DCTCE 5-Corner Model - Click "Next Step" to progress</div>
                <div class="svg-container">
                    <svg width="950" height="720" viewBox="0 0 950 720" id="sequence-diagram">
                        <!-- Corner Labels at top -->
                        <g class="participant-group">
                            <rect x="60" y="20" width="130" height="65" rx="8" fill="#1a1a1a"/>
                            <text x="125" y="45" text-anchor="middle" fill="white" font-size="18" font-weight="700">C1 - Seller</text>
                            <text x="125" y="65" text-anchor="middle" fill="#aaa" font-size="12">ERP System</text>
                        </g>

                        <g class="participant-group">
                            <rect x="250" y="20" width="130" height="65" rx="8" fill="#00732f"/>
                            <text x="315" y="45" text-anchor="middle" fill="white" font-size="18" font-weight="700">C2 - ASP</text>
                            <text x="315" y="65" text-anchor="middle" fill="#cfc" font-size="12">Seller's ASP</text>
                        </g>

                        <g class="participant-group">
                            <rect x="440" y="20" width="130" height="65" rx="8" fill="#00732f"/>
                            <text x="505" y="45" text-anchor="middle" fill="white" font-size="18" font-weight="700">C3 - ASP</text>
                            <text x="505" y="65" text-anchor="middle" fill="#cfc" font-size="12">Buyer's ASP</text>
                        </g>

                        <g class="participant-group">
                            <rect x="630" y="20" width="130" height="65" rx="8" fill="#1a1a1a"/>
                            <text x="695" y="45" text-anchor="middle" fill="white" font-size="18" font-weight="700">C4 - Buyer</text>
                            <text x="695" y="65" text-anchor="middle" fill="#aaa" font-size="12">ERP System</text>
                        </g>

                        <g class="participant-group">
                            <rect x="800" y="20" width="130" height="65" rx="8" fill="#ce1126"/>
                            <text x="865" y="45" text-anchor="middle" fill="white" font-size="18" font-weight="700">C5 - FTA</text>
                            <text x="865" y="65" text-anchor="middle" fill="#fcc" font-size="12">Tax Authority</text>
                        </g>

                        <!-- Lifelines -->
                        <line x1="125" y1="85" x2="125" y2="660" stroke="#d0d0d0" stroke-width="2" stroke-dasharray="8,6"/>
                        <line x1="315" y1="85" x2="315" y2="660" stroke="#d0d0d0" stroke-width="2" stroke-dasharray="8,6"/>
                        <line x1="505" y1="85" x2="505" y2="660" stroke="#d0d0d0" stroke-width="2" stroke-dasharray="8,6"/>
                        <line x1="695" y1="85" x2="695" y2="660" stroke="#d0d0d0" stroke-width="2" stroke-dasharray="8,6"/>
                        <line x1="865" y1="85" x2="865" y2="660" stroke="#d0d0d0" stroke-width="2" stroke-dasharray="8,6"/>

                        <!-- STEP 1: Seller creates invoice -->
                        <g class="step-element" data-step="1">
                            <rect x="119" y="100" width="12" height="40" rx="4" fill="#e5e5e5" stroke="#999"/>
                            <rect x="70" y="105" width="100" height="30" rx="6" fill="#f7f7f8" stroke="#d0d0d0"/>
                            <text x="120" y="125" text-anchor="middle" font-size="11" font-weight="600" fill="#1a1a1a">Create Invoice</text>
                        </g>

                        <!-- STEP 2: Send to Seller ASP -->
                        <g class="step-element" data-step="2">
                            <line x1="131" y1="155" x2="303" y2="155" stroke="#1a1a1a" stroke-width="3"/>
                            <polygon points="303,155 291,149 291,161" fill="#1a1a1a"/>
                            <rect x="165" y="138" width="120" height="26" rx="6" fill="white" stroke="#1a1a1a" stroke-width="2"/>
                            <text x="225" y="156" text-anchor="middle" font-size="11" font-weight="700" fill="#1a1a1a">1: Send Invoice</text>
                        </g>

                        <!-- STEP 3: ASP validates & converts -->
                        <g class="step-element" data-step="3">
                            <rect x="309" y="170" width="12" height="50" rx="4" fill="#e5e5e5" stroke="#999"/>
                            <rect x="330" y="175" width="100" height="40" rx="6" fill="#ecfdf5" stroke="#00732f"/>
                            <text x="380" y="193" text-anchor="middle" font-size="10" font-weight="600" fill="#00732f">Validate &</text>
                            <text x="380" y="207" text-anchor="middle" font-size="9" fill="#059669">Convert to PINT AE</text>
                        </g>

                        <!-- STEP 4: Send via Peppol AS4 -->
                        <g class="step-element" data-step="4">
                            <line x1="321" y1="235" x2="493" y2="235" stroke="#00732f" stroke-width="3"/>
                            <polygon points="493,235 481,229 481,241" fill="#00732f"/>
                            <rect x="350" y="218" width="130" height="26" rx="6" fill="#00732f"/>
                            <text x="415" y="236" text-anchor="middle" font-size="11" font-weight="700" fill="white">2: AS4 Invoice</text>
                            <!-- Note: AS4 sent once -->
                            <rect x="440" y="195" width="90" height="20" rx="4" fill="#fffbeb" stroke="#d97706"/>
                            <text x="485" y="209" text-anchor="middle" font-size="8" font-weight="600" fill="#92400e">Sent only ONCE</text>
                        </g>

                        <!-- STEP 5: AS4 Response (+/-) -->
                        <g class="step-element" data-step="5">
                            <rect x="499" y="250" width="12" height="70" rx="4" fill="#e5e5e5" stroke="#999"/>
                            <!-- Alt frame for AS4 response -->
                            <rect x="325" y="255" width="200" height="60" rx="6" fill="none" stroke="#d0d0d0" stroke-width="2"/>
                            <rect x="325" y="255" width="30" height="16" rx="3" fill="#f7f7f8" stroke="#d0d0d0"/>
                            <text x="340" y="267" text-anchor="middle" font-size="8" font-weight="700" fill="#666">alt</text>
                            <!-- Success -->
                            <text x="335" y="282" font-size="9" fill="#059669" font-weight="600">[success]</text>
                            <line x1="499" y1="285" x2="327" y2="285" stroke="#059669" stroke-width="2" stroke-dasharray="6,4"/>
                            <polygon points="327,285 337,280 337,290" fill="#059669"/>
                            <rect x="370" y="274" width="80" height="20" rx="4" fill="#ecfdf5" stroke="#059669"/>
                            <text x="410" y="288" text-anchor="middle" font-size="10" font-weight="700" fill="#059669">3a: AS4 +</text>
                            <!-- Failure -->
                            <line x1="325" y1="300" x2="525" y2="300" stroke="#d0d0d0" stroke-dasharray="4,3"/>
                            <text x="335" y="312" font-size="9" fill="#dc2626" font-weight="600">[failure]</text>
                            <rect x="370" y="302" width="80" height="18" rx="4" fill="#fef2f2" stroke="#dc2626"/>
                            <text x="410" y="314" text-anchor="middle" font-size="9" font-weight="700" fill="#dc2626">3b: AS4 -</text>
                        </g>

                        <!-- STEP 6: MLS Response (optional, 1+ times) -->
                        <g class="step-element" data-step="6">
                            <!-- Opt frame for MLS -->
                            <rect x="325" y="330" width="200" height="50" rx="6" fill="none" stroke="#d0d0d0" stroke-width="2"/>
                            <rect x="325" y="330" width="30" height="16" rx="3" fill="#f7f7f8" stroke="#d0d0d0"/>
                            <text x="340" y="342" text-anchor="middle" font-size="8" font-weight="700" fill="#666">opt</text>
                            <text x="365" y="342" font-size="8" fill="#666" font-style="italic">[MLS supported]</text>
                            <!-- MLS message -->
                            <line x1="499" y1="360" x2="327" y2="360" stroke="#7c3aed" stroke-width="2" stroke-dasharray="6,4"/>
                            <polygon points="327,360 337,355 337,365" fill="#7c3aed"/>
                            <rect x="355" y="348" width="110" height="22" rx="5" fill="#f5f3ff" stroke="#7c3aed"/>
                            <text x="410" y="364" text-anchor="middle" font-size="10" font-weight="700" fill="#6d28d9">4: MLS (1+ times)</text>
                            <!-- MLS note -->
                            <rect x="530" y="335" width="85" height="42" rx="5" fill="#f5f3ff" stroke="#7c3aed"/>
                            <text x="572" y="350" text-anchor="middle" font-size="8" font-weight="600" fill="#6d28d9">MLS Status:</text>
                            <text x="572" y="362" text-anchor="middle" font-size="7" fill="#7c3aed">AP/AB/RE</text>
                            <text x="572" y="372" text-anchor="middle" font-size="7" fill="#7c3aed">DL/DF/SV/BV</text>
                        </g>

                        <!-- STEP 7: Report TDD to FTA (Seller ASP) -->
                        <g class="step-element" data-step="7">
                            <line x1="321" y1="400" x2="853" y2="400" stroke="#ce1126" stroke-width="2" stroke-dasharray="8,5"/>
                            <polygon points="853,400 843,395 843,405" fill="#ce1126"/>
                            <rect x="530" y="386" width="120" height="22" rx="5" fill="#fef2f2" stroke="#ce1126"/>
                            <text x="590" y="401" text-anchor="middle" font-size="10" font-weight="700" fill="#ce1126">5: TDD Report</text>
                        </g>

                        <!-- STEP 8: Buyer ASP validates & delivers to C4 -->
                        <g class="step-element" data-step="8">
                            <rect x="499" y="420" width="12" height="40" rx="4" fill="#e5e5e5" stroke="#999"/>
                            <rect x="520" y="425" width="80" height="30" rx="5" fill="#ecfdf5" stroke="#00732f"/>
                            <text x="560" y="445" text-anchor="middle" font-size="9" font-weight="600" fill="#00732f">Validate</text>
                        </g>

                        <!-- STEP 9: Report TDD to FTA (Buyer ASP) -->
                        <g class="step-element" data-step="9">
                            <line x1="511" y1="475" x2="853" y2="475" stroke="#ce1126" stroke-width="2" stroke-dasharray="8,5"/>
                            <polygon points="853,475 843,470 843,480" fill="#ce1126"/>
                            <rect x="620" y="461" width="120" height="22" rx="5" fill="#fef2f2" stroke="#ce1126"/>
                            <text x="680" y="476" text-anchor="middle" font-size="10" font-weight="700" fill="#ce1126">6: TDD Report</text>
                        </g>

                        <!-- STEP 10: Deliver to Buyer -->
                        <g class="step-element" data-step="10">
                            <line x1="511" y1="505" x2="683" y2="505" stroke="#1a1a1a" stroke-width="3"/>
                            <polygon points="683,505 671,499 671,511" fill="#1a1a1a"/>
                            <rect x="545" y="490" width="110" height="24" rx="5" fill="white" stroke="#1a1a1a" stroke-width="2"/>
                            <text x="600" y="507" text-anchor="middle" font-size="11" font-weight="700" fill="#1a1a1a">7: Deliver</text>
                            <!-- Acknowledgment back -->
                            <line x1="683" y1="540" x2="511" y2="540" stroke="#666" stroke-width="2" stroke-dasharray="6,4"/>
                            <polygon points="511,540 521,535 521,545" fill="#666"/>
                            <text x="600" y="555" text-anchor="middle" font-size="9" fill="#666">ACK</text>
                        </g>

                        <!-- 5-Corner Note -->
                        <rect x="780" y="500" width="150" height="70" rx="8" fill="#fef2f2" stroke="#ce1126"/>
                        <text x="855" y="520" text-anchor="middle" font-size="10" font-weight="700" fill="#ce1126">5th Corner (FTA)</text>
                        <text x="855" y="536" text-anchor="middle" font-size="9" fill="#991b1b">Both ASPs report</text>
                        <text x="855" y="550" text-anchor="middle" font-size="9" fill="#991b1b">Tax Data (TDD)</text>
                        <text x="855" y="564" text-anchor="middle" font-size="9" fill="#991b1b">in real-time</text>

                        <!-- Bottom labels -->
                        <rect x="60" y="665" width="130" height="22" rx="6" fill="#1a1a1a"/>
                        <text x="125" y="680" text-anchor="middle" fill="white" font-size="11" font-weight="600">C1</text>

                        <rect x="250" y="665" width="130" height="22" rx="6" fill="#00732f"/>
                        <text x="315" y="680" text-anchor="middle" fill="white" font-size="11" font-weight="600">C2</text>

                        <rect x="440" y="665" width="130" height="22" rx="6" fill="#00732f"/>
                        <text x="505" y="680" text-anchor="middle" fill="white" font-size="11" font-weight="600">C3</text>

                        <rect x="630" y="665" width="130" height="22" rx="6" fill="#1a1a1a"/>
                        <text x="695" y="680" text-anchor="middle" fill="white" font-size="11" font-weight="600">C4</text>

                        <rect x="800" y="665" width="130" height="22" rx="6" fill="#ce1126"/>
                        <text x="865" y="680" text-anchor="middle" fill="white" font-size="11" font-weight="600">C5</text>
                    </svg>
                </div>

                <div class="legend-bar">
                    <div class="legend-item">
                        <div class="legend-line solid"></div>
                        <span>Invoice/Delivery (AS4)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width:24px;height:2px;background:repeating-linear-gradient(90deg,#059669 0px,#059669 4px,transparent 4px,transparent 8px);"></div>
                        <span>AS4 Response (+/-)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width:24px;height:2px;background:repeating-linear-gradient(90deg,#7c3aed 0px,#7c3aed 4px,transparent 4px,transparent 8px);"></div>
                        <span>MLS (1+ times)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line tax"></div>
                        <span>Tax Data to FTA</span>
                    </div>
                </div>
            </div>

            <!-- Info Cards -->
            <div class="info-grid">
                <div class="info-card expanded" id="card-corners">
                    <div class="info-card-header" onclick="toggleCard('card-corners')">
                        <div class="info-card-icon">&#127968;</div>
                        <h3>The 5 Corners Explained</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Corner</th>
                                    <th>Role</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>C1</strong></td>
                                    <td>Seller</td>
                                    <td>Creates invoice in their ERP/accounting system</td>
                                </tr>
                                <tr>
                                    <td><strong>C2</strong></td>
                                    <td>Seller's ASP</td>
                                    <td>Validates, converts to PINT AE, sends via Peppol</td>
                                </tr>
                                <tr>
                                    <td><strong>C3</strong></td>
                                    <td>Buyer's ASP</td>
                                    <td>Receives, validates, delivers to buyer</td>
                                </tr>
                                <tr>
                                    <td><strong>C4</strong></td>
                                    <td>Buyer</td>
                                    <td>Receives invoice in their ERP system</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot red"></span><strong>C5</strong></td>
                                    <td>FTA</td>
                                    <td>Receives Tax Data Document from both ASPs</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card expanded" id="card-diff">
                    <div class="info-card-header" onclick="toggleCard('card-diff')">
                        <div class="info-card-icon">&#8644;</div>
                        <h3>4-Corner vs 5-Corner</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Aspect</th>
                                    <th>4-Corner (Standard Peppol)</th>
                                    <th>5-Corner (UAE DCTCE)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Tax Reporting</strong></td>
                                    <td>None / Separate</td>
                                    <td><span class="status-dot red"></span>Real-time to FTA</td>
                                </tr>
                                <tr>
                                    <td><strong>Participants</strong></td>
                                    <td>C1, C2, C3, C4</td>
                                    <td>C1, C2, C3, C4, <strong>C5 (FTA)</strong></td>
                                </tr>
                                <tr>
                                    <td><strong>Data Flow</strong></td>
                                    <td>Invoice only</td>
                                    <td>Invoice + Tax Data Document</td>
                                </tr>
                                <tr>
                                    <td><strong>Model Name</strong></td>
                                    <td>Peppol 4-Corner</td>
                                    <td>DCTCE (Decentralized CTC)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ACCREDITATION TAB ==================== -->
        <div id="accreditation-tab" class="tab-content">
            <div class="section-header">
                <div class="section-icon">&#128203;</div>
                <h2>ASP Accreditation Process</h2>
            </div>

            <div class="step-controls">
                <button class="step-btn secondary" id="accredPrevBtn" onclick="accredPrevStep()" disabled>Previous</button>
                <div class="step-indicator">
                    <span>Step</span>
                    <strong id="accredCurrentStep">1</strong>
                    <span>of</span>
                    <strong>6</strong>
                </div>
                <div class="step-title" id="accredStepTitle">Submit Application to Ministry of Finance</div>
                <button class="step-btn primary" id="accredNextBtn" onclick="accredNextStep()">Next Step</button>
            </div>

            <div class="accred-flow" id="accredFlow">
                <div class="accred-step active" data-accred="1">
                    <div class="accred-step-num">1</div>
                    <div class="accred-step-title">Submit<br>Application</div>
                </div>
                <div class="accred-arrow">&#8594;</div>
                <div class="accred-step" data-accred="2">
                    <div class="accred-step-num">2</div>
                    <div class="accred-step-title">Pre-approval<br>Testing</div>
                </div>
                <div class="accred-arrow">&#8594;</div>
                <div class="accred-step" data-accred="3">
                    <div class="accred-step-num">3</div>
                    <div class="accred-step-title">Production<br>Trial Run</div>
                </div>
                <div class="accred-arrow">&#8594;</div>
                <div class="accred-step" data-accred="4">
                    <div class="accred-step-num">4</div>
                    <div class="accred-step-title">Pre-approval<br>Certification</div>
                </div>
                <div class="accred-arrow">&#8594;</div>
                <div class="accred-step" data-accred="5">
                    <div class="accred-step-num">5</div>
                    <div class="accred-step-title">Tax Data<br>Testing</div>
                </div>
                <div class="accred-arrow">&#8594;</div>
                <div class="accred-step" data-accred="6">
                    <div class="accred-step-num">6</div>
                    <div class="accred-step-title">Final<br>Accreditation</div>
                </div>
            </div>

            <div class="diagram-container" id="accredDetails">
                <h3 style="margin-bottom:16px;font-size:16px;">Step 1: Submit Application</h3>
                <p style="color:var(--text-secondary);margin-bottom:16px;">Submit complete application package to the Ministry of Finance with all required documentation.</p>

                <h4 style="font-size:13px;margin-bottom:12px;color:var(--text-secondary);">Required Documents:</h4>
                <div class="req-list">
                    <div class="req-item"><div class="req-check">&#10003;</div>Trade License</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>Proof of Paid-up Capital</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>UAE Corporate Tax Registration</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>Power of Attorney</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>2+ Years E-invoicing Experience</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>OpenPeppol SP Agreement</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>ISO 22301 Certificate</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>ISO 27001 Certificate</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>Technical Environment Design</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>MFA & Encryption Details</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>Security Monitoring Details</div>
                    <div class="req-item"><div class="req-check">&#10003;</div>Insurance Documents</div>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-card expanded" id="card-eligibility">
                    <div class="info-card-header" onclick="toggleCard('card-eligibility')">
                        <div class="info-card-icon">&#9989;</div>
                        <h3>Eligibility Requirements</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Requirement</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Peppol Certified</strong></td>
                                    <td>Active Peppol-certified Service Provider</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Experience</strong></td>
                                    <td>Minimum 2 years operating e-invoicing systems</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>ISO 27001</strong></td>
                                    <td>Information Security certification</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>ISO 22301</strong></td>
                                    <td>Business Continuity certification</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Insurance</strong></td>
                                    <td>Professional indemnity + cyber risk coverage</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>UAE Compliance</strong></td>
                                    <td>Corporate Tax Registration in UAE</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card expanded" id="card-penalties">
                    <div class="info-card-header" onclick="toggleCard('card-penalties')">
                        <div class="info-card-icon">&#9888;</div>
                        <h3>Penalty Framework</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <p style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;">Cabinet Decision No. 106 of 2025</p>
                        <table class="penalty-table">
                            <thead>
                                <tr>
                                    <th>Violation</th>
                                    <th>Penalty</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Failure to implement system</td>
                                    <td><span class="penalty-amount">AED 5,000/month</span></td>
                                </tr>
                                <tr>
                                    <td>Failure to appoint ASP</td>
                                    <td><span class="penalty-amount">AED 5,000/month</span></td>
                                </tr>
                                <tr>
                                    <td>Failure to issue/transmit e-invoice</td>
                                    <td><span class="penalty-amount">AED 100/invoice</span><br><small>(max AED 5,000/month)</small></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TIMELINE TAB ==================== -->
        <div id="timeline-tab" class="tab-content">
            <div class="section-header">
                <div class="section-icon">&#128197;</div>
                <h2>Implementation Timeline</h2>
            </div>

            <div class="diagram-container">
                <div class="timeline">
                    <div class="timeline-line"></div>

                    <div class="timeline-item">
                        <div class="timeline-date">1 July 2026</div>
                        <div class="timeline-title">Pilot Programme Starts</div>
                        <div class="timeline-desc">Selected businesses in Taxpayer Working Group begin testing. Voluntary adoption opens for all.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">31 July 2026</div>
                        <div class="timeline-title">Large Business ASP Deadline</div>
                        <div class="timeline-desc">Businesses with revenue  AED 50M must appoint an Accredited Service Provider.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">1 January 2027</div>
                        <div class="timeline-title">Phase 1 Go-Live</div>
                        <div class="timeline-desc">Mandatory e-invoicing for businesses with revenue  AED 50 million.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">31 March 2027</div>
                        <div class="timeline-title">Smaller Business ASP Deadline</div>
                        <div class="timeline-desc">Businesses with revenue < AED 50M and government entities must appoint ASP.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">1 July 2027</div>
                        <div class="timeline-title">Phase 2 Go-Live</div>
                        <div class="timeline-desc">Mandatory e-invoicing for all remaining businesses (SMEs).</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">1 October 2027</div>
                        <div class="timeline-title">Phase 3 Go-Live</div>
                        <div class="timeline-desc">Government entities must fully comply with e-invoicing requirements.</div>
                    </div>
                </div>
            </div>

            <div class="info-card expanded" id="card-phases" style="margin-top:24px;">
                <div class="info-card-header" onclick="toggleCard('card-phases')">
                    <div class="info-card-icon">&#128200;</div>
                    <h3>Phase Summary</h3>
                    <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                    </svg>
                </div>
                <div class="info-card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Phase</th>
                                <th>Who</th>
                                <th>Appoint ASP By</th>
                                <th>Go-Live</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="status-dot blue"></span><strong>Pilot</strong></td>
                                <td>Taxpayer Working Group</td>
                                <td>-</td>
                                <td>1 Jul 2026</td>
                            </tr>
                            <tr>
                                <td><span class="status-dot green"></span><strong>Phase 1</strong></td>
                                <td>Revenue  AED 50M</td>
                                <td>31 Jul 2026</td>
                                <td><strong>1 Jan 2027</strong></td>
                            </tr>
                            <tr>
                                <td><span class="status-dot orange"></span><strong>Phase 2</strong></td>
                                <td>Revenue < AED 50M</td>
                                <td>31 Mar 2027</td>
                                <td><strong>1 Jul 2027</strong></td>
                            </tr>
                            <tr>
                                <td><span class="status-dot red"></span><strong>Phase 3</strong></td>
                                <td>Government Entities</td>
                                <td>31 Mar 2027</td>
                                <td><strong>1 Oct 2027</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== TECHNICAL TAB ==================== -->
        <div id="technical-tab" class="tab-content">
            <div class="section-header">
                <div class="section-icon">&#128187;</div>
                <h2>Technical Specifications</h2>
            </div>

            <div class="info-grid">
                <div class="info-card expanded" id="card-format">
                    <div class="info-card-header" onclick="toggleCard('card-format')">
                        <div class="info-card-icon">&#128196;</div>
                        <h3>PINT AE Format</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <p style="margin-bottom:12px;color:var(--text-secondary);">PINT AE = Peppol International for UAE</p>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Specification</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Base Standard</td>
                                    <td><code>UBL 2.1</code></td>
                                </tr>
                                <tr>
                                    <td>Profile</td>
                                    <td><code>Peppol BIS Billing 3.0</code></td>
                                </tr>
                                <tr>
                                    <td>CustomizationID</td>
                                    <td><code>urn:peppol:pint:billing-1@ae-1.0</code></td>
                                </tr>
                                <tr>
                                    <td>ProfileID</td>
                                    <td><code>urn:peppol:bis:billing</code></td>
                                </tr>
                                <tr>
                                    <td>Transport</td>
                                    <td><code>AS4</code> over Peppol network</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="code-block" style="margin-top:16px;">
<span class="tag">&lt;?xml</span> <span class="attr">version</span>=<span class="value">"1.0"</span> <span class="attr">encoding</span>=<span class="value">"UTF-8"</span><span class="tag">?&gt;</span>
<span class="tag">&lt;Invoice</span> <span class="attr">xmlns</span>=<span class="value">"urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;cbc:CustomizationID&gt;</span><span class="value">urn:peppol:pint:billing-1@ae-1.0</span><span class="tag">&lt;/cbc:CustomizationID&gt;</span>
  <span class="tag">&lt;cbc:ProfileID&gt;</span><span class="value">urn:peppol:bis:billing</span><span class="tag">&lt;/cbc:ProfileID&gt;</span>
  ...
<span class="tag">&lt;/Invoice&gt;</span>
                        </div>
                    </div>
                </div>

                <div class="info-card expanded" id="card-codes">
                    <div class="info-card-header" onclick="toggleCard('card-codes')">
                        <div class="info-card-icon">&#128209;</div>
                        <h3>Code Lists</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data Element</th>
                                    <th>Code List</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Currency</td>
                                    <td><code>ISO 4217</code> (AED, USD, EUR...)</td>
                                </tr>
                                <tr>
                                    <td>Unit of Measure</td>
                                    <td><code>UN/ECE Rec 20</code></td>
                                </tr>
                                <tr>
                                    <td>Country</td>
                                    <td><code>ISO 3166-1 alpha-2</code></td>
                                </tr>
                                <tr>
                                    <td>Tax Category</td>
                                    <td><code>UNCL 5305</code></td>
                                </tr>
                                <tr>
                                    <td>Invoice Type</td>
                                    <td><code>UNCL 1001</code> (380, 381...)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card expanded" id="card-scope">
                    <div class="info-card-header" onclick="toggleCard('card-scope')">
                        <div class="info-card-icon">&#127919;</div>
                        <h3>Scope & Exclusions</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <h4 style="color:var(--success);margin-bottom:8px;">&#10003; In Scope</h4>
                        <ul style="margin-left:20px;margin-bottom:16px;color:var(--text-secondary);">
                            <li>B2B transactions</li>
                            <li>B2G transactions</li>
                            <li>All VAT-registered entities</li>
                        </ul>

                        <h4 style="color:var(--error);margin-bottom:8px;">&#10007; Excluded</h4>
                        <ul style="margin-left:20px;color:var(--text-secondary);">
                            <li>B2C transactions</li>
                            <li>Government sovereign activities</li>
                            <li>Certain airline international transport</li>
                            <li>Exempt financial services</li>
                        </ul>
                    </div>
                </div>

                <div class="info-card expanded" id="card-storage">
                    <div class="info-card-header" onclick="toggleCard('card-storage')">
                        <div class="info-card-icon">&#128451;</div>
                        <h3>Storage Requirements</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Requirement</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Standard Retention</td>
                                    <td><strong>5 years</strong> after tax period</td>
                                </tr>
                                <tr>
                                    <td>Real Estate / Disputes</td>
                                    <td>Up to <strong>15 years</strong></td>
                                </tr>
                                <tr>
                                    <td>Storage Location</td>
                                    <td><strong>Must be in UAE</strong></td>
                                </tr>
                                <tr>
                                    <td>Transmission Deadline</td>
                                    <td>Within <strong>14 days</strong> of transaction</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== PKI TAB ==================== -->
        <div id="pki-tab" class="tab-content">
            <div class="section-header">
                <div class="section-icon">&#128274;</div>
                <h2>PKI & Certificates</h2>
            </div>

            <div class="diagram-container">
                <div class="diagram-title">Certificate Authority Hierarchy</div>
                <div class="pki-tree">
                    <div class="pki-node root">
                        <div class="pki-node-title">OpenPeppol Root CA - G3</div>
                        <div class="pki-node-desc">The ultimate trust anchor (2025-2035)</div>
                    </div>

                    <div style="width:2px;height:30px;background:var(--border-color);"></div>

                    <div class="pki-children">
                        <div class="pki-node intermediate">
                            <div class="pki-node-title">ACCESS POINT CA - G3</div>
                            <div class="pki-node-desc">Issues certificates to APs</div>
                        </div>
                        <div class="pki-node intermediate">
                            <div class="pki-node-title">SMP CA - G3</div>
                            <div class="pki-node-desc">Issues certificates to SMPs</div>
                        </div>
                    </div>

                    <div style="width:2px;height:30px;background:var(--border-color);"></div>

                    <div class="pki-children">
                        <div class="pki-node leaf">
                            <div class="pki-node-title">Your ASP Certificate</div>
                            <div class="pki-node-desc">e.g., POP000602 (Clear)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-card expanded" id="card-pki-what">
                    <div class="info-card-header" onclick="toggleCard('card-pki-what')">
                        <div class="info-card-icon">&#128272;</div>
                        <h3>What is PKI?</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <p style="margin-bottom:16px;">PKI (Public Key Infrastructure) is the trust system ensuring e-invoices are:</p>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Authentic</strong></td>
                                    <td>Really from who they claim to be</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Untampered</strong></td>
                                    <td>Not modified in transit</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Non-repudiable</strong></td>
                                    <td>Sender can't deny sending</td>
                                </tr>
                                <tr>
                                    <td><span class="status-dot green"></span><strong>Confidential</strong></td>
                                    <td>Encrypted in transit</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card expanded" id="card-pki-analogy">
                    <div class="info-card-header" onclick="toggleCard('card-pki-analogy')">
                        <div class="info-card-icon">&#128255;</div>
                        <h3>Passport Analogy</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Real World</th>
                                    <th>PKI Equivalent</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Passport Office</td>
                                    <td><strong>Certificate Authority (CA)</strong></td>
                                </tr>
                                <tr>
                                    <td>Passport</td>
                                    <td><strong>Digital Certificate</strong></td>
                                </tr>
                                <tr>
                                    <td>Photo + Signature</td>
                                    <td><strong>Public Key</strong> (verifiable)</td>
                                </tr>
                                <tr>
                                    <td>Secret PIN</td>
                                    <td><strong>Private Key</strong> (only you have)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card expanded" id="card-generations">
                    <div class="info-card-header" onclick="toggleCard('card-generations')">
                        <div class="info-card-icon">&#128200;</div>
                        <h3>PKI Generations (G1, G2, G3)</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Generation</th>
                                    <th>Validity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>G1</strong></td>
                                    <td>2012-2018</td>
                                    <td><span class="status-dot red"></span>Retired</td>
                                </tr>
                                <tr>
                                    <td><strong>G2</strong></td>
                                    <td>2018-2028</td>
                                    <td><span class="status-dot orange"></span>Being phased out</td>
                                </tr>
                                <tr>
                                    <td><strong>G3</strong></td>
                                    <td>2025-2035</td>
                                    <td><span class="status-dot green"></span>Current</td>
                                </tr>
                            </tbody>
                        </table>

                        <div style="background:#fffbeb;padding:12px;border-radius:8px;margin-top:16px;border:1px solid #fcd34d;">
                            <strong style="color:#92400e;">Migration Deadline:</strong>
                            <span style="color:#92400e;">All ASPs must migrate to G3 by <strong>1 April 2026</strong></span>
                        </div>
                    </div>
                </div>

                <div class="info-card expanded" id="card-keys">
                    <div class="info-card-header" onclick="toggleCard('card-keys')">
                        <div class="info-card-icon">&#128273;</div>
                        <h3>Public vs Private Key</h3>
                        <svg class="expand-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="info-card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Who Has It</th>
                                    <th>Used For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Private Key</strong></td>
                                    <td>Only owner (SECRET!)</td>
                                    <td>Signing outgoing messages</td>
                                </tr>
                                <tr>
                                    <td><strong>Public Key</strong></td>
                                    <td>Everyone (in certificate)</td>
                                    <td>Verifying signatures</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <strong>Sources:</strong>
                <a href="https://mof.gov.ae/en/services/accreditation-of-e-invoicing-service-providers/" target="_blank">UAE Ministry of Finance</a> &bull;
                <a href="https://www.cleartax.com/ae/e-invoicing-uae" target="_blank">Cleartax UAE</a> &bull;
                <a href="https://docs.peppol.eu/" target="_blank">Peppol Docs</a>
            </p>
            <p style="margin-top:10px;">UAE E-Invoicing Guide | Clear</p>
        </footer>
    </div>

    <script>
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // 5-Corner Flow Steps
        const steps = [
            { title: "Seller creates invoice in ERP", description: "Invoice created in seller's accounting/ERP system" },
            { title: "Send invoice to Seller's ASP", description: "Invoice transmitted to the seller's Accredited Service Provider" },
            { title: "ASP validates & converts to PINT AE", description: "ASP validates data and converts to UAE standard XML format" },
            { title: "Send via Peppol AS4 (sent ONCE)", description: "Invoice transmitted over Peppol network using AS4 protocol" },
            { title: "AS4 Response (+/-) from Buyer ASP", description: "Immediate transport acknowledgment - success (+) or failure (-)" },
            { title: "MLS Response (optional, 1+ times)", description: "Message Level Status: AP/AB/RE with reason codes DL/DF/SV/BV" },
            { title: "Seller ASP reports TDD to FTA", description: "Tax Data Document sent to Federal Tax Authority (5th corner)" },
            { title: "Buyer ASP validates invoice", description: "Receiving ASP validates the incoming invoice" },
            { title: "Buyer ASP reports TDD to FTA", description: "Buyer's ASP also reports Tax Data to FTA" },
            { title: "Deliver invoice to Buyer", description: "Invoice delivered to buyer's ERP system with acknowledgment" }
        ];

        let currentStepIndex = 0;
        const totalSteps = steps.length;

        function initStepProgress() {
            const container = document.getElementById('stepProgress');
            container.innerHTML = '';
            for (let i = 0; i < totalSteps; i++) {
                const dot = document.createElement('div');
                dot.className = 'step-dot';
                dot.onclick = () => goToStep(i);
                container.appendChild(dot);
            }
        }

        function updateStepUI() {
            document.getElementById('currentStep').textContent = currentStepIndex + 1;
            document.getElementById('totalSteps').textContent = totalSteps;
            document.getElementById('stepTitle').textContent = steps[currentStepIndex].title;

            document.getElementById('prevBtn').disabled = currentStepIndex === 0;
            document.getElementById('nextBtn').disabled = currentStepIndex === totalSteps - 1;

            const dots = document.querySelectorAll('.step-dot');
            dots.forEach((dot, i) => {
                dot.className = 'step-dot';
                if (i < currentStepIndex) dot.classList.add('completed');
                else if (i === currentStepIndex) dot.classList.add('active');
            });

            updateVisibleSteps();
        }

        function updateVisibleSteps() {
            document.querySelectorAll('.step-element').forEach(el => {
                const stepNum = parseInt(el.dataset.step);
                if (stepNum <= currentStepIndex + 1) {
                    el.classList.add('visible');
                    if (stepNum === currentStepIndex + 1) el.classList.add('animate-in');
                    else el.classList.remove('animate-in');
                } else {
                    el.classList.remove('visible', 'animate-in');
                }
            });
        }

        function nextStep() {
            if (currentStepIndex < totalSteps - 1) { currentStepIndex++; updateStepUI(); }
        }

        function prevStep() {
            if (currentStepIndex > 0) { currentStepIndex--; updateStepUI(); }
        }

        function goToStep(index) {
            if (index >= 0 && index < totalSteps) { currentStepIndex = index; updateStepUI(); }
        }

        function resetSteps() {
            currentStepIndex = 0; updateStepUI();
        }

        // Accreditation Steps
        const accredSteps = [
            { title: "Submit Application to Ministry of Finance", content: "Submit complete application package with all required documentation including Trade License, ISO certifications, insurance, and technical details." },
            { title: "Pre-approval Testing", content: "Ministry conducts technical testing to verify system capabilities, Peppol conformance, and integration readiness." },
            { title: "Production Trial Run", content: "Conduct real-world testing in production environment with sample transactions to validate end-to-end flow." },
            { title: "Pre-approval Certification", content: "Upon successful testing, receive pre-approval certification allowing limited production access." },
            { title: "Tax Data Reporting Testing", content: "Test the Tax Data Document (TDD) reporting to FTA systems to ensure compliance with tax reporting requirements." },
            { title: "Final Accreditation Certification", content: "Receive full ASP accreditation allowing commercial operation and onboarding of taxpayers." }
        ];

        let accredCurrentStep = 0;

        function updateAccredUI() {
            document.getElementById('accredCurrentStep').textContent = accredCurrentStep + 1;
            document.getElementById('accredStepTitle').textContent = accredSteps[accredCurrentStep].title;

            document.getElementById('accredPrevBtn').disabled = accredCurrentStep === 0;
            document.getElementById('accredNextBtn').disabled = accredCurrentStep === accredSteps.length - 1;

            document.querySelectorAll('.accred-step').forEach((step, i) => {
                step.classList.remove('active', 'completed');
                if (i < accredCurrentStep) step.classList.add('completed');
                else if (i === accredCurrentStep) step.classList.add('active');
            });

            const detailsDiv = document.getElementById('accredDetails');
            detailsDiv.innerHTML = `
                <h3 style="margin-bottom:16px;font-size:16px;">Step ${accredCurrentStep + 1}: ${accredSteps[accredCurrentStep].title}</h3>
                <p style="color:var(--text-secondary);margin-bottom:16px;">${accredSteps[accredCurrentStep].content}</p>
            `;

            if (accredCurrentStep === 0) {
                detailsDiv.innerHTML += `
                    <h4 style="font-size:13px;margin-bottom:12px;color:var(--text-secondary);">Required Documents:</h4>
                    <div class="req-list">
                        <div class="req-item"><div class="req-check">&#10003;</div>Trade License</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>Proof of Paid-up Capital</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>UAE Corporate Tax Registration</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>Power of Attorney</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>2+ Years E-invoicing Experience</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>OpenPeppol SP Agreement</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>ISO 22301 Certificate</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>ISO 27001 Certificate</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>Technical Environment Design</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>MFA & Encryption Details</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>Security Monitoring Details</div>
                        <div class="req-item"><div class="req-check">&#10003;</div>Insurance Documents</div>
                    </div>
                `;
            }
        }

        function accredNextStep() {
            if (accredCurrentStep < accredSteps.length - 1) { accredCurrentStep++; updateAccredUI(); }
        }

        function accredPrevStep() {
            if (accredCurrentStep > 0) { accredCurrentStep--; updateAccredUI(); }
        }

        // Card toggle
        function toggleCard(cardId) {
            document.getElementById(cardId).classList.toggle('expanded');
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextStep();
            else if (e.key === 'ArrowLeft') prevStep();
            else if (e.key === 'r' || e.key === 'R') resetSteps();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initStepProgress();
            updateStepUI();
            updateAccredUI();
        });
    </script>
</body>
</html>
